# D&D-Lite

**D&D-Lite** — современное веб-приложение для проведения настольных ролевых игр (D&D и аналогов) с поддержкой карт, токенов, бросков кубиков, логов действий и синхронизации в реальном времени.

---

## Архитектура

- **Frontend:** React (TypeScript, Vite), Zustand/Redux, WebSocket, Konva.js/PixiJS
- **Backend:** FastAPI (Python), WebSocket, in-memory-хранилища (MongoDB заявлен, но не используется)
- **Тесты:** pytest, pytest-asyncio, websockets

---

## Структура проекта

```
DNDLite/
  client/    # Фронтенд (React)
  server/    # Бэкенд (FastAPI)
```

---

## Быстрый старт

1. **Установите зависимости:**

   ```sh
   cd client
   npm install
   cd ../server
   pip install -r requirements.txt
   ```

2. **Запустите backend:**

   ```sh
   cd server
   uvicorn server.src.main:app
   ```

3. **Запустите frontend:**

   ```sh
   cd client
   npm run dev
   ```

4. **Откройте** [http://localhost:5173](http://localhost:5173) в браузере.

---

## Основные возможности

- **Карта с редактируемыми стенами и заштриховкой**
- **Токены:** добавление, перемещение, удаление
- **Броски кубиков** с историей
- **Action log:** журнал всех ключевых событий сессии
- **Список игроков, назначение ГМа, кик**
- **Асинхронные тесты на все основные сценарии**

---

## Подробная дорожная карта

### MVP (минимально жизнеспособный продукт)

1. **Базовая структура и настройка**

   - Инициализация репозитория, настройка окружения, базовые скрипты запуска

2. **Ядро backend (сервер, WebSocket)**

   - FastAPI, WebSocket, in-memory сессии, базовые модели

3. **Ядро frontend (SPA, WebSocket)**

   - React SPA, подключение к серверу, базовая карта

4. **Карта, токены, броски кубиков**

   - Редактируемая карта, добавление/перемещение/удаление токенов, броски кубиков

5. **Action log (журнал событий)**

   - [Выполнено] Лог всех ключевых действий, отображение на фронте, тесты

6. **Минимальная авторизация (ТЕКУЩИЙ ЭТАП)**

   - REST-эндпоинты регистрации/логина (in-memory)
   - Передача имени пользователя в сессию и лог
   - Форма логина/регистрации на фронте
   - Тесты на регистрацию, вход, отображение имени

7. **UI/UX улучшения**

   - Красивый интерфейс, адаптивность, всплывающие уведомления

8. **Сохранение и восстановление сессий**

   - (Опционально) Подключение MongoDB, хранение карт, логов, пользователей

9. **Мобильная версия**

   - Адаптация интерфейса под мобильные устройства

10. **Документация и деплой**
    - Подробная документация, инструкции по развертыванию, CI/CD

---

## API (кратко)

### WebSocket

- `/ws/game/{session_id}` — основной канал для синхронизации карты, токенов, игроков, логов

### REST (будет доработано)

- `POST /register` — регистрация пользователя
- `POST /login` — вход пользователя

---

## Тестирование

- Все основные сценарии покрыты асинхронными тестами (`pytest server/tests/test_main.py --timeout=5`)
- Каждый тест изолирован, не зависит от других
- Для разработки рекомендуется запускать сервер **без** флага `--reload` для избежания конфликтов с WebSocket

---

## Вклад и обратная связь

- Pull requests приветствуются!
- Для предложений и багов — создавайте issue.

---

**Текущий этап:**

> **Минимальная авторизация (регистрация/логин, имя пользователя в сессии и логе, тесты)**
